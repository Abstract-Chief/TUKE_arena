#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f lock_arena/data/pretest.sh 
#endif

static  char data [] = 
#define      date_z	1
#define      date	((&data[0]))
	"\252"
#define      rlax_z	1
#define      rlax	((&data[1]))
	"\320"
#define      chk2_z	19
#define      chk2	((&data[3]))
	"\215\264\334\271\241\031\060\065\122\217\343\044\137\074\011\224"
	"\006\172\302\356\252\135"
#define      opts_z	1
#define      opts	((&data[24]))
	"\067"
#define      msg2_z	19
#define      msg2	((&data[26]))
	"\240\220\333\106\131\365\114\027\165\163\203\166\317\257\245\371"
	"\116\361\324\050\261\147\200\100"
#define      chk1_z	22
#define      chk1	((&data[52]))
	"\025\170\333\220\232\270\012\121\263\350\213\260\024\150\105\312"
	"\211\254\131\261\065\364\115\314\055\176"
#define      msg1_z	65
#define      msg1	((&data[75]))
	"\145\304\145\310\142\347\205\143\131\232\252\137\366\050\002\002"
	"\114\063\017\343\225\313\232\334\361\351\152\172\032\020\254\131"
	"\267\122\046\165\264\072\360\264\027\334\052\245\152\302\352\315"
	"\353\141\150\137\136\317\051\266\034\170\174\217\265\044\135\160"
	"\367\361\277\311"
#define      text_z	4857
#define      text	((&data[981]))
	"\020\076\324\155\355\276\217\217\007\163\060\271\333\260\371\151"
	"\074\071\176\264\025\374\324\034\061\305\334\372\117\215\044\137"
	"\313\370\315\271\267\134\111\276\320\171\170\253\051\161\024\145"
	"\253\222\032\300\217\356\334\301\264\271\273\003\106\340\143\021"
	"\331\060\312\220\215\023\117\135\214\310\011\266\071\035\033\344"
	"\257\066\245\077\045\202\000\331\073\274\335\201\234\100\223\166"
	"\161\136\007\377\162\127\135\376\037\146\264\130\203\320\075\063"
	"\006\342\163\053\145\163\005\240\057\342\042\314\043\265\102\224"
	"\024\111\224\206\240\362\205\300\130\071\030\334\012\126\020\021"
	"\071\203\075\236\366\102\077\046\044\141\363\107\027\065\334\053"
	"\177\161\261\040\143\066\340\274\160\371\231\173\120\251\214\211"
	"\055\311\050\044\014\147\112\060\310\075\170\340\163\125\013\363"
	"\307\275\023\052\364\364\347\145\356\200\340\076\052\154\310\127"
	"\066\360\173\102\130\306\163\041\004\354\001\170\101\015\153\011"
	"\313\177\063\277\164\033\044\142\233\005\241\306\161\151\036\247"
	"\132\232\352\263\140\135\324\145\111\326\336\213\344\112\224\257"
	"\312\310\157\076\343\224\241\177\231\102\105\012\254\143\262\007"
	"\376\234\273\136\372\220\304\103\146\242\317\112\355\143\372\267"
	"\054\151\365\017\375\227\217\226\331\324\241\206\070\124\216\066"
	"\360\111\225\353\331\132\056\100\375\376\213\352\142\206\241\216"
	"\360\227\236\356\056\055\204\010\002\046\216\073\172\035\161\153"
	"\147\007\126\101\142\205\202\137\204\015\112\346\224\353\164\204"
	"\202\023\162\260\100\367\270\102\035\107\175\230\145\357\004\315"
	"\367\133\016\131\341\220\271\145\236\003\113\063\357\300\267\162"
	"\323\051\042\024\041\333\127\076\043\325\327\211\304\334\126\274"
	"\067\145\026\031\366\320\176\225\324\312\310\303\213\177\065\136"
	"\251\130\163\312\064\312\011\130\237\341\341\144\275\070\040\365"
	"\235\067\016\224\007\215\051\333\130\361\237\343\161\324\101\033"
	"\055\265\345\141\177\357\272\036\320\234\202\216\324\243\204\162"
	"\333\222\006\342\040\057\276\170\041\135\133\223\062\235\256\140"
	"\122\224\302\321\204\174\360\125\030\163\343\355\027\147\137\362"
	"\372\145\325\033\225\223\223\267\361\357\112\044\214\371\204\337"
	"\216\106\261\022\303\241\147\334\024\113\311\054\263\050\036\255"
	"\215\363\311\043\207\134\332\171\113\045\235\330\036\042\267\254"
	"\151\150\277\055\011\047\011\036\162\322\112\045\372\151\323\210"
	"\135\234\253\344\371\206\135\104\253\373\034\312\036\324\167\210"
	"\074\066\265\106\135\276\145\320\220\260\366\213\031\312\023\166"
	"\147\277\132\140\106\270\245\362\264\302\274\323\226\063\133\322"
	"\152\020\030\310\317\176\231\137\056\217\353\107\131\377\275\300"
	"\277\030\041\005\321\306\370\206\210\264\131\036\350\264\361\123"
	"\305\012\034\224\210\265\364\266\105\337\376\236\337\273\137\236"
	"\324\201\244\246\107\234\054\320\121\205\357\072\072\340\215\377"
	"\353\251\223\164\137\207\052\244\147\050\103\106\344\243\344\271"
	"\044\211\137\153\045\213\074\166\021\053\261\113\014\076\113\367"
	"\350\336\153\110\146\226\354\316\276\057\024\243\323\371\134\367"
	"\202\274\143\250\107\237\037\131\312\320\245\326\017\360\316\367"
	"\316\071\100\065\320\054\003\216\134\027\062\057\021\217\047\223"
	"\113\212\074\223\052\133\354\365\053\221\314\072\201\232\062\120"
	"\324\162\205\244\237\211\063\373\240\146\053\262\365\122\106\100"
	"\335\202\323\007\335\300\374\011\121\310\103\323\143\166\044\067"
	"\351\251\334\210\062\017\204\323\165\257\205\152\002\313\253\337"
	"\116\177\347\053\077\343\064\221\254\170\145\017\357\211\107\330"
	"\063\043\140\146\063\344\017\346\024\135\017\170\353\270\025\120"
	"\001\042\350\035\366\351\105\361\317\115\327\207\060\327\316\226"
	"\033\202\131\365\255\367\261\054\200\346\314\324\367\224\334\116"
	"\122\222\176\354\010\344\105\073\220\114\050\377\273\114\323\370"
	"\255\170\334\056\220\051\217\135\201\033\337\222\154\035\225\120"
	"\077\072\137\157\174\235\334\254\066\311\161\172\327\254\366\251"
	"\236\267\164\162\255\271\316\343\351\247\026\177\261\135\355\072"
	"\012\200\121\341\057\375\124\014\173\042\361\304\347\123\277\162"
	"\125\067\134\162\245\066\344\051\030\106\005\232\166\356\301\307"
	"\121\203\257\167\321\357\211\057\333\032\346\073\063\235\021\002"
	"\377\146\267\033\246\246\361\377\333\056\166\350\034\233\063\245"
	"\241\251\176\322\016\311\026\063\203\216\217\270\112\372\234\066"
	"\377\172\240\074\112\107\171\365\321\052\270\316\041\217\133\331"
	"\377\065\113\274\366\366\065\142\021\223\017\300\045\133\374\170"
	"\051\272\042\127\323\273\315\214\360\034\374\201\326\300\343\221"
	"\136\335\125\136\217\115\162\327\310\246\337\007\350\032\205\352"
	"\256\114\060\007\320\231\031\104\050\142\355\243\042\200\116\330"
	"\140\264\301\004\030\370\234\061\025\251\256\311\205\356\254\334"
	"\060\141\370\136\131\312\330\235\101\036\243\356\372\237\167\156"
	"\044\161\153\202\217\326\057\047\333\000\153\346\216\163\044\262"
	"\103\042\264\036\362\230\006\065\216\340\351\305\202\147\111\202"
	"\244\026\064\120\306\302\363\276\015\110\371\250\331\126\303\061"
	"\052\031\310\071\132\103\041\225\125\054\230\023\175\377\325\260"
	"\377\241\251\177\244\312\302\012\137\050\207\303\334\332\340\252"
	"\134\053\063\104\350\104\125\011\113\177\237\053\313\136\275\067"
	"\222\034\234\313\147\054\270\317\152\022\142\065\340\351\124\244"
	"\023\120\367\150\365\107\375\302\067\040\075\375\050\110\031\017"
	"\007\070\015\361\266\355\324\147\117\163\344\225\201\143\220\112"
	"\121\236\126\066\253\360\045\145\337\223\320\344\273\121\044\224"
	"\126\025\315\335\341\346\237\261\275\332\027\106\070\017\105\253"
	"\325\224\242\263\173\007\177\356\271\304\352\266\213\232\003\331"
	"\373\156\122\256\066\123\062\062\111\120\051\067\251\253\134\133"
	"\225\063\170\367\145\341\146\043\202\036\161\347\367\134\306\075"
	"\270\011\254\143\270\237\366\223\011\255\304\347\243\016\004\343"
	"\065\043\225\066\000\052\046\251\231\375\344\227\102\351\317\261"
	"\113\123\075\254\155\171\373\152\356\145\267\350\173\021\122\220"
	"\331\106\150\275\113\165\062\270\206\176\247\117\244\374\336\360"
	"\112\231\240\122\324\126\102\127\025\046\164\311\211\333\252\320"
	"\135\017\075\012\070\100\066\371\134\222\012\270\306\341\270\135"
	"\224\345\072\146\276\203\002\277\261\250\001\162\257\005\160\060"
	"\257\266\371\116\164\312\220\277\217\243\200\306\140\204\337\200"
	"\150\166\054\332\075\123\173\063\076\064\023\257\355\141\223\031"
	"\241\264\064\365\244\214\334\165\223\260\207\005\324\174\217\125"
	"\205\370\226\315\360\174\056\041\272\073\047\155\132\112\146\066"
	"\362\102\040\046\121\133\336\101\073\123\001\226\357\330\101\210"
	"\020\361\114\322\214\000\117\153\201\030\231\313\310\201\243\037"
	"\355\060\017\041\375\274\135\224\137\313\154\105\013\160\127\005"
	"\216\241\171\070\140\216\202\151\257\133\151\132\373\317\101\373"
	"\173\231\243\017\175\164\017\057\063\214\277\017\044\000\314\364"
	"\277\271\213\314\323\243\250\201\221\061\056\306\106\014\154\306"
	"\335\311\073\166\151\055\045\127\275\252\046\153\242\304\355\136"
	"\001\326\120\135\300\006\356\070\313\237\222\237\333\305\303\027"
	"\054\221\046\365\367\256\020\121\376\327\211\317\023\221\300\022"
	"\112\316\234\264\003\323\350\332\237\243\034\136\301\304\066\121"
	"\213\314\056\137\264\376\140\151\307\047\057\330\140\124\060\304"
	"\371\275\231\375\255\076\140\156\143\035\160\213\253\170\013\014"
	"\333\374\122\174\057\310\162\077\277\225\245\332\016\123\242\262"
	"\274\070\050\076\127\034\070\154\231\025\260\032\346\227\233\100"
	"\034\172\225\205\357\257\105\126\100\251\175\305\000\015\141\137"
	"\233\207\140\211\131\231\300\050\025\351\054\010\340\324\216\153"
	"\212\143\232\023\346\305\224\355\347\317\107\057\304\066\276\025"
	"\125\226\172\176\213\050\012\150\323\346\134\336\334\204\221\011"
	"\324\365\306\350\152\233\157\207\155\014\103\263\066\215\341\243"
	"\322\113\066\327\100\100\321\173\364\332\225\100\074\005\104\021"
	"\266\232\320\047\064\012\257\214\205\000\116\011\367\122\302\213"
	"\033\360\120\026\277\140\041\100\155\347\132\122\346\040\373\035"
	"\123\027\076\230\105\003\210\064\126\332\113\275\331\235\236\333"
	"\017\314\242\135\065\261\114\274\175\327\326\244\166\364\056\346"
	"\111\036\367\301\250\160\063\037\054\064\152\223\210\114\013\070"
	"\066\004\175\320\303\370\242\175\345\056\367\152\362\256\325\357"
	"\217\224\323\033\334\056\034\277\317\074\361\362\352\356\234\333"
	"\023\204\326\373\171\232\064\135\042\065\240\312\301\060\312\101"
	"\353\172\327\142\311\335\341\113\340\306\067\246\324\122\022\146"
	"\211\347\011\320\307\046\354\362\012\000\037\236\173\243\331\231"
	"\200\227\354\364\365\307\331\314\162\200\136\160\321\073\236\263"
	"\377\200\345\333\172\037\135\142\043\033\212\151\247\230\354\126"
	"\031\275\110\156\250\053\074\236\252\054\356\140\275\145\031\256"
	"\367\155\324\145\174\260\347\227\360\051\363\152\366\310\333\335"
	"\200\130\054\054\142\260\177\217\133\317\036\157\347\353\321\151"
	"\251\002\276\343\050\344\246\343\166\261\150\275\121\000\320\304"
	"\137\247\132\101\102\032\016\176\006\261\250\304\253\233\113\261"
	"\335\076\125\272\077\126\233\030\276\213\175\030\342\307\211\177"
	"\006\142\076\171\062\200\314\226\306\342\343\164\026\273\166\163"
	"\321\126\005\251\030\246\213\170\212\104\240\274\207\053\061\117"
	"\370\363\112\267\005\020\236\121\261\275\110\316\036\205\333\141"
	"\073\372\224\122\024\065\010\126\203\223\165\024\154\012\130\077"
	"\352\326\317\304\230\106\250\230\357\301\304\134\325\041\362\253"
	"\112\165\012\314\206\334\112\167\175\016\207\165\312\077\124\366"
	"\077\274\307\256\311\250\231\163\144\240\035\312\341\104\133\360"
	"\025\046\103\314\372\275\225\332\141\060\101\170\231\356\207\322"
	"\271\331\200\341\366\205\317\006\255\374\061\042\142\335\104\341"
	"\247\312\205\170\054\315\325\254\342\215\373\172\015\353\322\122"
	"\151\125\021\202\305\011\071\232\360\371\110\345\203\113\035\332"
	"\157\262\303\256\154\142\331\264\251\113\363\332\261\102\353\301"
	"\015\307\120\011\074\036\175\174\221\015\244\301\055\224\000\103"
	"\013\213\350\005\327\241\004\150\117\355\015\130\224\167\040\207"
	"\343\013\327\305\105\063\062\321\244\041\142\330\301\003\340\046"
	"\340\370\241\340\205\213\151\106\163\054\122\370\144\235\212\006"
	"\245\166\267\233\134\146\151\023\160\356\056\000\336\277\055\353"
	"\065\073\213\011\126\112\272\005\110\255\156\241\250\210\106\053"
	"\321\076\335\352\126\273\157\370\041\161\027\350\355\074\341\352"
	"\145\062\063\006\035\147\150\245\217\211\231\337\157\074\136\315"
	"\344\156\315\314\265\204\015\023\077\102\003\044\165\047\147\372"
	"\224\235\030\130\076\133\255\267\216\320\177\373\355\167\260\211"
	"\116\002\047\221\357\041\114\113\073\032\226\235\075\262\217\175"
	"\123\110\070\264\252\052\105\074\132\370\167\367\351\341\200\176"
	"\063\264\210\024\174\003\256\225\333\026\312\162\327\374\305\163"
	"\257\050\260\135\070\260\334\177\041\266\237\022\051\010\147\322"
	"\176\025\365\370\051\073\327\045\203\157\135\105\132\257\012\153"
	"\034\130\247\273\060\240\156\116\375\035\217\015\353\040\226\157"
	"\041\277\064\163\306\205\253\164\074\054\012\335\131\167\300\164"
	"\242\373\017\077\376\113\306\050\332\176\246\075\230\345\265\103"
	"\225\307\214\307\162\364\154\136\143\161\224\333\034\203\336\321"
	"\334\165\352\014\037\111\340\332\240\363\011\204\107\120\057\356"
	"\176\256\117\022\031\026\253\044\334\310\361\236\330\163\326\155"
	"\051\147\355\256\210\253\341\217\013\252\377\111\270\041\341\161"
	"\154\324\215\276\323\071\317\304\245\357\372\120\247\006\016\070"
	"\341\075\173\146\363\126\212\025\137\273\302\077\202\236\113\000"
	"\044\007\350\145\332\275\306\340\063\300\120\236\241\270\253\374"
	"\212\042\046\225\353\244\115\313\277\231\135\207\307\062\361\176"
	"\051\124\074\022\323\262\374\377\364\003\253\262\221\202\301\366"
	"\042\140\346\375\324\151\077\237\100\301\014\236\304\112\277\337"
	"\220\277\121\370\017\137\251\353\077\017\206\201\207\046\233\310"
	"\162\317\046\347\125\104\132\004\375\271\165\220\051\334\022\154"
	"\333\331\315\131\332\364\271\343\017\075\325\130\277\115\230\175"
	"\036\123\157\036\041\376\265\335\110\211\063\070\042\104\347\314"
	"\353\216\254\253\040\141\241\057\370\135\030\366\176\214\316\211"
	"\232\362\171\057\363\162\326\017\105\002\144\253\320\027\010\202"
	"\121\000\120\113\121\136\065\255\146\344\266\311\162\317\066\222"
	"\035\017\070\172\112\300\124\040\322\043\071\275\271\216\312\144"
	"\102\123\113\346\371\020\331\307\025\270\373\314\243\157\257\213"
	"\132\335\315\133\044\001\234\356\204\217\172\035\122\203\131\223"
	"\056\211\153\174\351\312\203\262\120\317\317\215\320\277\047\056"
	"\333\361\041\315\040\000\121\334\176\143\065\154\270\377\340\377"
	"\324\316\137\007\014\055\070\141\142\323\041\236\171\275\271\206"
	"\273\063\222\062\035\314\333\002\037\153\047\374\204\101\141\036"
	"\145\162\115\123\206\370\025\254\171\264\213\263\252\372\034\377"
	"\101\164\066\100\304\236\175\025\104\325\254\010\065\166\247\261"
	"\362\021\176\104\345\251\072\116\154\220\253\350\332\115\140\164"
	"\022\241\237\166\272\167\106\222\343\105\032\317\315\256\145\075"
	"\136\237\266\307\000\360\000\202\110\062\036\113\312\171\134\101"
	"\111\023\276\063\077\326\164\073\066\212\174\116\142\270\071\274"
	"\266\012\320\040\326\270\101\154\160\205\307\061\067\233\277\067"
	"\255\062\274\040\015\230\034\070\307\271\275\021\273\233\361\325"
	"\117\202\260\241\234\234\304\010\143\007\205\252\204\366\354\120"
	"\246\020\364\004\000\161\171\177\077\266\231\117\121\106\166\001"
	"\163\237\221\174\144\135\314\102\001\267\143\160\313\362\304\040"
	"\362\311\143\265\346\200\174\010\347\123\342\064\166\174\355\227"
	"\275\206\305\041\027\163\013\076\313\206\305\071\177\233\357\311"
	"\013\077\014\372\331\324\066\113\072\200\262\114\300\030\035\206"
	"\153\247\074\171\263\104\044\225\074\317\001\021\350\263\177\040"
	"\300\316\257\206\232\026\227\213\272\243\074\370\104\233\052\023"
	"\057\170\332\321\040\374\167\253\133\011\226\122\076\360\042\244"
	"\246\303\357\071\271\036\145\240\007\331\214\036\123\254\317\127"
	"\354\266\343\117\272\241\274\370\353\067\101\146\201\006\326\261"
	"\053\203\211\203\345\262\141\267\176\210\343\317\120\276\102\071"
	"\262\265\054\320\267\122\116\350\044\314\043\035\373\171\030\177"
	"\001\061\001\032\066\257\255\205\003\167\103\154\240\316\172\223"
	"\154\122\252\035\323\121\163\352\324\025\376\017\302\001\166\351"
	"\026\113\125\133\006\102\203\364\202\004\302\160\364\024\075\363"
	"\302\371\212\007\306\001\145\323\101\357\060\041\166\325\223\332"
	"\312\262\014\343\022\026\213\141\344\232\144\001\115\023\263\031"
	"\273\261\121\207\070\007\246\342\016\234\124\303\337\045\204\133"
	"\121\030\304\047\226\024\130\026\376\372\075\170\014\163\364\212"
	"\350\015\335\061\356\162\063\327\301\277\365\041\145\373\322\026"
	"\276\262\120\232\024\326\022\345\303\321\331\367\333\052\241\121"
	"\304\143\040\040\133\240\326\343\106\202\151\322\171\230\217\377"
	"\362\350\136\306\331\173\152\163\116\000\246\131\247\061\245\216"
	"\240\172\312\006\133\160\161\007\075\373\275\330\326\344\263\360"
	"\377\215\362\364\323\122\361\055\232\151\111\105\347\046\341\145"
	"\215\366\263\353\206\223\324\334\120\170\326\213\200\336\000\106"
	"\210\014\026\132\343\061\152\027\147\272\020\006\154\216\022\132"
	"\270\314\351\330\260\233\356\366\045\013\347\052\163\034\250\054"
	"\151\323\163\306\216\365\206\072\143\277\131\023\162\007\025\124"
	"\336\301\140\302\312\246\123\377\101\226\230\365\152\254\073\121"
	"\007\144\301\106\220\127\334\122\072\166\154\041\242\165\342\005"
	"\246\210\173\071\120\354\273\211\166\066\166\014\256\066\300\013"
	"\240\323\210\361\326\252\370\135\071\340\000\202\023\250\033\243"
	"\347\263\031\232\133\320\227\137\133\106\223\160\167\377\134\153"
	"\301\146\105\056\264\322\045\173\014\205\345\221\357\310\363\210"
	"\255\032\231\347\135\135\366\365\066\110\071\046\265\176\014\356"
	"\341\255\324\072\152\335\356\161\056\232\165\134\116\330\120\102"
	"\000\216\202\115\014\117\227\132\261\040\104\272\020\261\143\166"
	"\056\323\014\235\125\366\303\216\032\310\112\137\056\163\260\225"
	"\020\314\234\360\213\041\066\114\372\026\367\320\234\230\224\176"
	"\233\143\044\275\046\000\036\042\033\241\172\205\263\207\131\065"
	"\343\106\235\056\031\245\331\012\354\332\077\025\334\100\100\060"
	"\017\221\232\120\330\270\163\060\257\013\351\002\013\172\233\025"
	"\043\170\150\100\232\103\173\124\025\271\244\240\276\177\274\101"
	"\144\200\100\364\314\233\303\105\274\203\302\302\041\267\335\263"
	"\167\054\120\001\131\343\351\305\231\363\005\374\303\366\114\160"
	"\163\115\172\074\172\066\057\361\071\031\236\346\150\013\174\255"
	"\311\061\325\141\170\316\272\252\202\033\004\062\322\122\304\056"
	"\216\064\333\104\277\312\015\253\127\307\213\006\126\072\341\146"
	"\214\251\104\371\336\244\075\205\072\133\016\201\064\376\366\337"
	"\324\171\242\367\007\057\251\233\230\073\112\205\044\012\047\261"
	"\206\270\005\037\020\001\267\045\240\375\267\053\162\367\332\273"
	"\035\355\262\111\173\253\255\323\277\200\046\145\016\314\312\043"
	"\057\016\130\107\353\121\226\132\256\211\135\322\151\227\371\042"
	"\211\030\373\141\365\107\200\105\365\301\356\310\233\370\274\102"
	"\113\071\106\023\255\301\050\267\212\276\126\370\233\264\326\261"
	"\270\106\146\241\324\002\215\025\122\153\240\373\133\276\257\230"
	"\303\225\172\275\106\333\320\301\206\016\143\157\306\271\260\320"
	"\077\173\352\315\062\303\210\000\372\201\366\364\274\102\115\250"
	"\373\146\026\206\004\045\324\307\111\110\221\325\163\127\236\020"
	"\140\167\320\034\050\003\124\174\165\353\124\160\164\331\112\036"
	"\376\057\307\374\312\302\226\020\325\051\341\162\226\274\224\052"
	"\357\223\103\336\054\255\072\011\215\165\206\140\125\040\363\104"
	"\171\121\057\163\354\362\036\100\043\126\326\267\000\113\305\121"
	"\207\142\104\147\126\074\257\350\364\360\155\321\106\064\277\116"
	"\131\211\057\040\215\267\123\101\360\372\300\101\165\162\273\014"
	"\213\157\076\257\344\200\264\356\171\232\345\304\271\264\306\224"
	"\101\211\066\252\300\234\354\206\024\115\010\322\073\152\230\015"
	"\052\334\056\236\140\345\130\361\302\160\142\203\260\167\300\202"
	"\017\267\235\002\223\247\072\326\117\316\204\316\315\171\316\022"
	"\050\124\254\212\146\242\153\210\215\261\002\250\127\074\015\057"
	"\147\061\021\010\071\176\073\001\345\277\022\044\026\366\145\227"
	"\360\205\100\256\351\043\271\005\001\022\332\352\251\235\140\156"
	"\230\376\067\313\242\242\153\273\366\072\377\272\347\166\220\213"
	"\145\210\156\212\023\275\236\007\327\177\220\342\323\142\264\101"
	"\271\147\112\350\143\347\363\067\230\213\021\220\002\002\172\377"
	"\130\010\017\245\221\231\036\035\030\043\300\342\177\240\341\126"
	"\241\164\027\113\353\022\120\365\026\070\160\124\220\120\237\360"
	"\314\150\207\013\267\070\261\173\201\010\066\154\353\170\273\041"
	"\014\123\075\145\171\260\214\151\037\123\173\121\050\327\367\151"
	"\311\376\024\376\125\115\343\162\130\265\154\103\251\025\223\375"
	"\137\076\065\171\013\145\376\067\056\114\014\162\005\372\144\163"
	"\070\240\070\177\315\022\123\074\100\340\347\133\213\147\036\346"
	"\165\077\374\170\002\227\006\115\003\026\307\106\246\320\003\143"
	"\353\062\162\143\053\152\104\371\120\100\213\163\375\176\267\164"
	"\233\136\264\027\013\310\375\114\027\063\211\023\161\153\333\224"
	"\302\033\050\017\037\000\251\055\243\132\300\331\014\162\004\156"
	"\035\265\277\357\320\312\336\035\031\135\123\157\260\163\014\217"
	"\356\141\362\225\206\144\120\273\135\242\072\265\221\335\266\020"
	"\140\024\122\333\305\210\205\112\166\261\124\367\124\150\037\276"
	"\246\231\322\261\103\053\170\271\024\345\232\155\166\372\274\315"
	"\050\110\120\105\132\166\126\064\275\245\034\220\326\164\026\333"
	"\351\224\334\064\030\046\366\236\326\224\303\315\237\172\222\036"
	"\340\122\275\151\177\253\207\357\327\041\117\242\175\170\333\374"
	"\162\147\135\213\034\306\205\011\100\236\204\312\113\305\337\002"
	"\104\333\015\103\321\041\005\377\145\241\073\121\272\211\131\376"
	"\042\256\244\035\333\321\254\214\037\132\110\105\060\167\074\075"
	"\345\333\163\306\274\311\355\257\374\330\021\226\174\252\327\005"
	"\360\335\101\161\062\230\347\122\135\111\256\172\046\033\107\164"
	"\204\360\141\161\304\361\240\161\374\252\374\055\231\027\151\375"
	"\320\152\076\034\011\366\336\165\230\062\256\030\152\054\127\217"
	"\317\342\030\326\302\240\073\010\167\352\261\064\071\031\267\062"
	"\301\045\340\326\367\027\352\346\207\056\173\050\201\052\375\206"
	"\141\152\037\315\043\141\016\267\057\060\012\335\337\377\013\337"
	"\220\160\361\070\055\031\225\375\237\301\073\165\267\016\127\226"
	"\075\056\130\305\217\014\000\371\050\224\224\036\366\276\243\114"
	"\252\072\024\223\030\253\043\071\235\335\300\065\104\337\045\351"
	"\323\323\050\036\251\233\316\212\172\254\175\073\224\103\225\237"
	"\325\106\225\317\240\364\105\222\151\002\154\324\214\102\057\101"
	"\163\122\262\007\260\117\134\162\365\025\302\126\276\250\041\304"
	"\354\357\311\165\111\330\237\106\313\103\247\225\137\312\102\034"
	"\230\031\014\333\167\117\271\351\047\133\004\046\057\353\374\331"
	"\311\003\035\116\037\335\371\141\107\013\052\301\151\233\137\205"
	"\126\352\026\001\243\331\035\150\076\324\251\167\152\114\207\152"
	"\105\010\247\143\370\273\256\055\276\222\027\367\177\376\215\266"
	"\360\110\213\261\254\372\046\155\341\363\013\005\144\066\322\021"
	"\177\340\162\366\223\107\102\344\005\275\305\056\136\206\061\237"
	"\032\150\017\315\326\074\054\366\115\171\052\076\371\254\237\221"
	"\223\255\070\123\140\057\062\203\120\272\272\315\016\246\074\352"
	"\017\250\367\163\140\275\111\117\241\211\175\050\100\375\254\347"
	"\024\046\265\012\170\101\155\011\357\320\114\215\221\160\302\263"
	"\203\211\133\371\250\213\064\131\062\377\207\234\041\107\372\257"
	"\107\165\266\235\063\227\335\027\224\226\155\065\013\341\075\272"
	"\244\150\143\323\211\367\015\014\072\111\206\151\017\176\350\126"
	"\106\274\150\344\316\064\201\000\322\274\307\147\173\312\151\204"
	"\124\127\142\267\145\160\175\317\117\266\147\021\174\264\073\304"
	"\035\044\015\156\050\055\170\113\112\061\307\037\363\270\321\241"
	"\373\027\060\127\151\367\261\040\345\064\026\032\346\072\060\002"
	"\075\117\142\176\252\014\054\276\342\172\241\061\352\070\360\341"
	"\107\016\373\217\225\105\214\211\105\243\020\237\261\003\346\030"
	"\342\267\325\374\124\011\026\231\312\141\253\074\007\236\061\215"
	"\072\002\055\172\311\107\360\106\272\350\355\202\126\000\277\215"
	"\073\246\141\244\031\317\107\351\273\025\207\132\075\022\051\214"
	"\242\046\074\062\276\240\214\367\066\213\311\365\252\024\156\111"
	"\034\143\016\036\024\373\143\306\225\067\171\003\204\336\151\155"
	"\261\374\265\204\026\074\111\163\277\143\230\330\241\274\207\256"
	"\065\276\202\023\142\357\113\165\333\235\050\316\376\236\375\041"
	"\140\354\151\016\264\134\100\106\164\246\306\255\011\351\141\114"
	"\076\151\335\136\207\370\213\371\377\035\206\230\027\064\353\307"
	"\201\226\317\133\361\323\350\230\303\366\104\145\301\300\050\326"
	"\214\374\123\261\070\250\161\041\155\326\245\001\063\365\341\027"
	"\377\066\366\120\350\165\303\303\321\042\032\230\342\007\126\352"
	"\060\274\311\055\334\334\346\361\156\157\336\030\371\320\050\002"
	"\061\155\373\373\076\045\347\162\301\340\067\272\150\072\035\336"
	"\123\312\001\173\344\007\130\261\217\221\305\032\374\215\261\214"
	"\165\211\214\377\270\011\210\065\245\303\344\107\330\112\303\314"
	"\232\142\106\103\237\010\123\120\135\307\023\114\220\172\223\134"
	"\212\136\213\265\023\246\321\300\243\300\141\340\155\321\147\355"
	"\010\221\173\074\126\052\014\234\152\254\030\154\037\177\161\231"
	"\276\211\155\260\014\203\225\102\270\320\103\204\216\321\216\147"
	"\245\061\042\222\310\305\060\361\214\014\077\322\263\364\005\015"
	"\047\150\176\101\245\256\351\165\151\032\244\146\014\271\352\373"
	"\157\121\250\074\230\077\075\162\066\350\365\212\140\376\111\357"
	"\006\356\264\301\263\065\240\170\224\267\276\171\254\254\035\235"
	"\213\305\125\014\027\221\006\207\055\131\274\151\322\301\264\246"
	"\056\046\340\213\110\336\013\030\011\042\372\003\027\076\101\103"
	"\144\156\320\134\237\052\040\252\023\047\230\170\136\073\250\336"
	"\153\254\167\105\142\070\064\241\236\174\026\030\130\313\142\263"
	"\346\312\135\365\207\274\113\247\215\136\100\211\366\055\273\072"
	"\251\224\300\024\226\214\277\166\332\076\135\005\176\100\072\017"
	"\355\263\164\374\242\376\104\173\061\147\333\227\232\300\321\104"
	"\125\222\130\354\036\027\142\370\126\277\376\324\000\071\344\355"
	"\354\131\352\217\127\056\012\210\225\346\040\060\247\362\164\374"
	"\204\315\351\242\345\113\233\073\012\231\020\013\322\365\371\277"
	"\116\343\116\246\021\131\057\247\100\117\330\347\102\115\344\307"
	"\032\315\152\377\030\005\073\043\236\114\057\161\101\050\060\217"
	"\013\177\066\035\331\145\304\031\265\235\000\367\352\344\276\005"
	"\262\050\004\313\056\100\357\314\214\036\076\315\106\157\135\122"
	"\356\223\157\310\370\064\341\256\321\341\245\274\306\144\301\170"
	"\215\306\104\273\006\063\210\222\121\306\140\230\066\275\352\045"
	"\121\132\355\112\216\316\370\140\257\236\034\166\002\335\357\217"
	"\244\063\113\252\147\323"
#define      shll_z	10
#define      shll	((&data[6039]))
	"\235\121\247\240\363\036\276\107\260\112\137\153\320"
#define      xecc_z	15
#define      xecc	((&data[6050]))
	"\370\044\301\374\100\351\202\364\376\246\316\114\175\326\135\254"
	"\226\343"
#define      pswd_z	256
#define      pswd	((&data[6077]))
	"\357\204\141\215\241\330\220\177\307\021\223\243\110\346\147\002"
	"\117\325\240\143\345\360\134\214\267\232\336\321\103\051\261\257"
	"\107\227\163\151\365\224\007\260\245\233\124\356\201\273\360\320"
	"\221\220\064\167\200\220\004\070\052\342\011\156\013\273\036\123"
	"\123\221\274\110\045\304\371\313\137\115\271\341\011\252\261\232"
	"\072\346\021\273\167\025\364\241\370\375\020\003\271\056\126\014"
	"\300\023\125\345\327\117\260\066\234\152\030\246\024\312\100\117"
	"\260\122\012\047\150\376\311\140\374\331\143\266\010\272\302\310"
	"\315\030\256\245\147\137\333\004\311\364\253\336\276\354\055\156"
	"\076\070\225\247\067\137\007\063\070\153\352\101\046\255\011\363"
	"\305\270\230\055\027\164\062\341\151\335\277\047\311\354\225\010"
	"\044\053\257\134\212\267\217\303\042\171\004\110\046\016\074\354"
	"\306\325\032\336\112\114\277\263\052\177\332\364\154\160\374\221"
	"\233\254\355\046\143\175\351\206\367\356\317\036\374\014\012\303"
	"\341\044\241\054\161\141\337\233\341\272\217\115\053\214\336\306"
	"\070\314\355\234\111\326\042\100\304\362\136\301\376\151\204\337"
	"\216\046\014\377\207\354\233\150\246\040\043\373\153\315\142\077"
	"\012\033\332\247\154\253\003\250\241\257\076\205\246\143\066\226"
	"\350\230\044\211\160\264\010\070\325\053\063\101\370\226\200\003"
	"\261\133\253\036\006\256"
#define      tst2_z	19
#define      tst2	((&data[6381]))
	"\005\055\005\264\015\211\016\177\012\001\301\240\235\042\341\035"
	"\144\371\120\007\150\305\150"
#define      lsto_z	1
#define      lsto	((&data[6401]))
	"\225"
#define      inlo_z	3
#define      inlo	((&data[6402]))
	"\324\142\243"
#define      tst1_z	22
#define      tst1	((&data[6407]))
	"\245\112\267\331\044\264\362\241\041\174\354\134\306\165\107\234"
	"\042\345\323\021\275\237\126\274\015\331\213\006\157"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
