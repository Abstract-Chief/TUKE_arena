#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f lock_arena/data/ps_tests/ps1/karel_arena.sh 
#endif

static  char data [] = 
#define      date_z	1
#define      date	((&data[0]))
	"\030"
#define      msg2_z	19
#define      msg2	((&data[1]))
	"\142\106\226\065\311\151\065\262\041\121\370\211\111\126\215\261"
	"\131\371\170\061"
#define      tst1_z	22
#define      tst1	((&data[25]))
	"\110\256\317\323\314\156\013\346\110\221\123\062\015\022\243\105"
	"\141\311\212\201\312\200\007\225\062\352\344\341\366\313"
#define      chk1_z	22
#define      chk1	((&data[56]))
	"\116\163\255\077\235\330\254\003\276\133\340\073\340\245\023\271"
	"\271\033\101\167\240\232\251\072\201\244\247\053\032"
#define      rlax_z	1
#define      rlax	((&data[80]))
	"\115"
#define      opts_z	1
#define      opts	((&data[81]))
	"\124"
#define      lsto_z	1
#define      lsto	((&data[82]))
	"\271"
#define      text_z	5238
#define      text	((&data[715]))
	"\154\304\024\074\227\371\035\216\305\231\150\061\347\334\337\046"
	"\171\012\101\020\055\262\321\034\361\070\026\221\321\221\367\076"
	"\125\013\173\355\005\230\173\312\061\344\374\031\300\333\077\072"
	"\345\200\112\023\063\033\060\044\124\106\266\046\330\256\144\056"
	"\272\337\033\277\170\227\211\252\174\206\303\074\141\002\166\107"
	"\203\301\133\266\335\213\333\061\322\222\130\252\100\274\330\372"
	"\234\364\272\025\214\104\277\010\312\202\104\054\205\273\163\011"
	"\174\316\277\131\132\233\213\055\055\343\327\156\240\260\150\075"
	"\245\042\122\061\147\021\072\061\224\177\135\031\072\321\043\267"
	"\240\343\021\372\176\235\047\254\201\377\032\042\260\202\137\125"
	"\245\261\207\014\303\301\076\130\100\234\162\173\155\225\063\015"
	"\170\104\010\366\341\060\242\143\060\274\205\340\077\344\066\345"
	"\226\275\362\132\177\060\262\300\315\044\073\072\271\156\110\061"
	"\263\121\050\225\201\312\370\262\207\175\223\306\142\311\253\370"
	"\207\235\123\006\316\005\307\233\051\002\326\342\161\036\024\044"
	"\157\074\271\361\006\262\244\216\060\067\124\222\001\000\213\210"
	"\236\336\217\155\343\126\010\015\131\337\360\312\375\004\357\155"
	"\100\251\137\107\133\003\325\213\073\052\036\074\053\252\305\311"
	"\210\124\066\154\253\077\172\004\036\152\317\034\157\276\212\257"
	"\147\351\367\303\355\315\117\051\367\155\146\042\027\053\354\240"
	"\200\043\015\054\142\207\060\201\362\000\235\141\276\047\020\046"
	"\021\010\351\377\325\070\050\315\246\216\357\276\272\334\136\072"
	"\377\154\146\142\363\227\343\345\227\201\107\126\251\127\175\273"
	"\140\146\272\065\237\343\002\106\162\362\004\054\317\143\147\316"
	"\320\316\061\303\146\025\251\376\227\360\124\100\110\321\374\250"
	"\070\267\336\330\233\341\037\015\323\043\072\242\207\242\161\127"
	"\160\242\033\327\267\305\325\117\265\052\217\376\374\214\247\064"
	"\103\205\015\336\146\054\354\072\120\046\335\327\311\116\057\072"
	"\361\112\021\251\017\346\370\305\020\210\304\014\024\154\101\130"
	"\361\117\066\130\173\043\223\313\112\160\243\023\277\322\115\260"
	"\035\137\131\055\105\121\362\126\332\267\143\356\043\244\107\025"
	"\364\176\156\157\241\001\073\353\162\336\377\061\261\115\341\316"
	"\254\073\373\361\215\356\110\147\246\253\126\311\120\235\337\104"
	"\033\115\264\275\117\357\251\301\315\250\363\177\365\325\116\241"
	"\020\111\223\236\070\333\006\336\206\134\250\327\372\207\033\026"
	"\324\317\323\043\277\174\345\215\045\330\014\032\255\132\274\276"
	"\244\117\134\334\052\142\273\261\277\143\211\271\352\244\320\277"
	"\164\243\343\063\040\310\300\105\241\315\140\116\047\034\015\313"
	"\154\151\250\227\314\144\110\213\307\321\105\262\166\025\162\353"
	"\271\125\037\331\036\340\037\277\064\152\127\166\273\210\043\237"
	"\132\016\033\341\234\142\103\370\226\117\327\054\167\350\076\304"
	"\161\043\312\256\334\205\134\027\105\001\201\165\027\116\226\323"
	"\211\064\322\020\142\224\062\214\106\247\372\254\070\053\002\353"
	"\360\117\207\204\136\266\216\075\170\305\076\071\265\326\270\100"
	"\173\102\035\125\121\157\356\252\344\322\032\165\000\063\237\012"
	"\156\175\320\047\147\075\237\056\260\265\270\124\325\343\251\341"
	"\256\155\165\363\031\173\264\252\335\303\165\223\337\222\033\273"
	"\277\275\061\077\066\110\102\322\362\245\303\141\111\322\061\343"
	"\011\343\276\332\050\141\325\136\336\152\127\315\035\360\314\256"
	"\237\331\233\173\122\135\272\231\255\071\134\320\277\064\004\077"
	"\314\240\207\113\015\241\136\052\136\124\031\323\217\204\246\175"
	"\112\032\163\213\054\367\140\275\341\034\137\112\024\006\107\371"
	"\374\223\075\357\132\057\217\002\023\103\207\075\123\070\126\173"
	"\031\161\155\301\264\374\366\100\275\271\262\201\124\244\243\007"
	"\005\210\300\275\171\256\357\146\131\213\044\110\020\121\376\347"
	"\350\205\377\073\373\245\221\363\317\135\115\061\054\173\057\204"
	"\056\052\073\126\236\231\353\074\175\017\142\364\304\365\302\204"
	"\067\250\221\156\015\210\334\133\054\055\327\113\202\272\174\023"
	"\321\003\370\115\022\215\343\035\034\317\317\355\100\325\302\347"
	"\171\024\334\125\326\041\267\351\326\222\046\206\177\147\050\042"
	"\345\356\274\166\357\253\331\025\047\012\045\024\210\114\335\045"
	"\316\360\051\373\270\120\061\046\160\342\004\313\301\142\222\150"
	"\117\113\367\112\337\360\011\327\025\351\142\245\133\115\136\323"
	"\070\373\336\174\320\356\123\215\354\235\325\225\344\045\030\155"
	"\322\133\204\067\151\172\203\337\173\215\327\225\110\114\301\162"
	"\055\230\070\024\317\267\364\133\134\320\132\351\024\362\035\177"
	"\314\074\031\363\330\034\327\103\112\125\156\105\063\110\231\212"
	"\312\225\346\247\037\132\372\323\335\052\052\351\115\273\004\045"
	"\345\233\053\127\270\357\073\300\174\364\246\231\103\101\342\035"
	"\156\147\040\107\141\260\250\007\116\205\247\153\006\210\047\334"
	"\075\336\077\303\326\243\240\157\102\131\021\274\344\002\167\116"
	"\226\354\034\164\316\250\067\042\336\326\251\256\202\351\170\101"
	"\023\016\260\244\063\231\213\027\246\041\257\105\240\212\260\256"
	"\247\022\250\076\014\343\067\321\364\371\172\200\366\111\240\260"
	"\335\165\034\330\074\277\117\141\061\217\343\115\177\024\126\123"
	"\216\212\321\151\007\067\020\103\316\313\341\071\123\333\070\027"
	"\274\176\302\023\144\024\015\357\042\267\055\136\331\204\201\340"
	"\154\244\103\355\112\160\242\101\375\031\147\130\375\025\020\246"
	"\003\306\370\160\154\260\271\256\321\261\260\316\044\165\174\047"
	"\251\142\041\204\367\234\212\015\300\350\214\113\064\024\007\212"
	"\323\167\323\206\352\135\326\245\267\056\141\110\240\065\103\260"
	"\374\251\343\074\127\104\131\151\154\251\145\257\025\175\254\052"
	"\225\041\165\360\014\116\122\361\327\131\111\101\164\316\371\044"
	"\252\035\057\172\253\252\307\213\021\304\032\275\224\106\362\246"
	"\341\016\141\107\370\365\343\274\271\337\216\034\113\076\203\246"
	"\140\367\362\301\025\056\015\337\373\244\130\266\007\302\014\126"
	"\366\033\136\254\261\073\302\127\217\156\270\037\322\067\160\074"
	"\155\307\167\010\320\044\144\250\203\016\060\227\243\206\255\034"
	"\054\267\077\035\107\333\340\372\300\276\136\010\043\121\101\223"
	"\106\376\042\243\143\317\155\063\347\244\124\313\066\156\001\341"
	"\273\337\106\154\001\025\223\217\263\011\303\221\204\202\072\045"
	"\345\023\070\042\147\357\265\062\001\007\246\363\371\235\221\260"
	"\014\224\320\103\056\171\153\261\247\251\232\243\362\205\035\207"
	"\213\343\177\206\066\114\327\130\160\161\270\030\166\060\117\317"
	"\022\115\142\126\242\235\301\350\243\335\111\335\113\102\324\214"
	"\121\340\344\313\206\035\232\255\026\150\236\150\032\017\224\366"
	"\165\124\120\217\372\004\047\166\135\005\320\231\012\131\334\065"
	"\246\164\142\046\153\334\054\334\135\073\341\145\371\302\020\124"
	"\126\013\144\237\045\156\146\337\052\157\107\235\206\143\176\027"
	"\275\063\004\021\227\276\300\212\324\016\145\107\007\106\201\061"
	"\344\160\254\105\355\062\137\117\053\333\006\214\151\244\247\201"
	"\214\102\307\070\042\242\372\303\230\174\117\355\320\335\071\110"
	"\364\374\020\171\171\005\066\374\055\017\325\161\230\222\375\017"
	"\333\041\316\153\266\046\042\043\040\103\127\103\014\356\342\034"
	"\221\352\036\110\374\246\314\016\227\027\256\134\206\025\145\375"
	"\035\256\312\354\310\050\033\240\237\243\303\172\214\163\251\164"
	"\273\067\334\376\361\167\001\276\165\160\114\360\041\165\054\104"
	"\152\203\320\067\047\111\042\155\111\302\030\234\136\027\044\367"
	"\243\122\147\222\100\303\340\267\260\117\004\251\240\133\157\343"
	"\266\324\243\064\323\372\167\147\345\366\172\073\266\267\106\252"
	"\140\022\205\202\223\377\340\210\306\304\377\100\276\050\146\276"
	"\013\341\220\126\115\246\307\033\024\071\215\220\076\260\111\126"
	"\207\302\272\310\216\360\267\350\121\105\075\035\103\107\052\177"
	"\103\374\235\143\212\106\362\006\301\347\216\125\114\071\273\335"
	"\201\040\326\151\352\107\146\364\120\042\301\045\344\150\143\104"
	"\172\153\146\251\036\204\312\144\153\255\234\237\146\203\117\127"
	"\021\073\332\131\132\004\254\371\124\040\055\056\251\137\127\021"
	"\074\207\116\325\251\134\130\337\207\243\312\100\357\124\207\330"
	"\001\057\052\327\221\077\125\264\040\057\224\277\250\101\245\274"
	"\020\310\271\244\353\106\226\263\323\125\220\036\256\273\245\147"
	"\007\311\314\335\345\244\065\101\121\274\013\236\067\252\353\306"
	"\160\110\115\272\141\115\340\136\347\116\332\011\331\250\204\327"
	"\333\133\100\154\276\214\076\233\346\236\006\006\030\212\257\372"
	"\217\151\133\261\031\122\161\330\121\212\367\174\156\314\305\007"
	"\341\241\033\036\337\164\314\126\016\011\366\241\261\040\170\054"
	"\235\222\157\355\223\035\066\220\004\274\263\125\310\056\327\337"
	"\317\034\034\075\076\025\217\205\175\365\161\073\077\205\307\142"
	"\111\116\076\355\252\115\226\220\235\052\267\067\072\113\331\220"
	"\075\134\136\007\312\144\251\060\147\351\373\010\273\253\026\072"
	"\140\324\336\054\330\003\130\350\125\221\373\152\137\131\331\042"
	"\174\317\303\312\256\253\031\103\117\130\275\127\375\215\011\374"
	"\276\277\306\311\162\063\206\313\226\146\033\266\056\227\150\172"
	"\153\161\304\254\227\374\036\147\336\054\060\206\230\303\333\340"
	"\062\233\242\165\251\303\252\075\336\351\020\006\036\053\372\012"
	"\012\233\010\141\234\116\045\313\057\340\370\100\227\377\163\243"
	"\155\336\271\355\372\156\247\221\374\000\027\135\327\103\246\373"
	"\210\165\262\330\320\301\116\214\075\375\076\236\311\047\241\213"
	"\301\103\077\357\250\335\027\264\367\276\157\052\320\110\360\324"
	"\323\337\361\073\220\144\047\274\130\250\140\023\323\245\130\302"
	"\136\202\203\232\272\177\345\023\243\326\017\050\247\302\204\152"
	"\122\277\053\153\061\372\102\326\026\147\101\132\367\173\024\303"
	"\336\116\132\230\107\226\166\341\213\305\306\113\335\302\107\033"
	"\136\226\367\053\100\341\253\345\165\272\256\353\101\075\251\270"
	"\043\375\320\054\253\045\012\050\113\165\264\150\322\125\331\000"
	"\335\311\254\226\137\021\011\303\262\147\041\001\103\126\262\344"
	"\276\263\036\232\222\122\030\326\236\201\322\120\003\156\313\261"
	"\317\160\003\110\035\214\043\172\016\111\041\134\046\343\366\046"
	"\110\047\362\235\300\075\046\312\142\237\253\335\037\373\217\176"
	"\137\337\036\033\102\002\055\245\331\006\241\241\142\340\134\222"
	"\311\371\304\037\057\020\145\157\142\177\161\352\304\041\373\103"
	"\202\366\032\346\137\025\022\153\376\326\201\064\015\273\371\166"
	"\045\262\116\262\175\353\064\167\230\242\324\216\063\375\157\316"
	"\016\105\372\076\234\302\135\003\147\025\113\325\042\130\036\372"
	"\117\250\365\157\022\101\300\210\040\375\304\123\002\375\341\153"
	"\220\111\210\251\251\244\251\320\361\304\375\351\220\006\066\136"
	"\046\176\203\231\024\115\072\246\035\271\237\375\220\047\054\360"
	"\305\014\232\146\117\336\256\120\225\002\256\306\053\270\073\301"
	"\172\121\101\147\177\222\214\374\221\170\247\267\333\032\162\332"
	"\150\145\040\042\060\147\331\177\230\072\266\051\251\341\066\164"
	"\032\365\132\005\037\365\333\045\132\305\357\374\141\057\045\262"
	"\311\000\065\156\101\026\110\017\013\013\115\346\034\111\122\367"
	"\245\162\354\260\237\343\364\101\105\062\316\361\344\260\203\042"
	"\233\236\066\121\215\301\044\174\111\205\335\017\142\227\354\350"
	"\325\351\277\131\364\374\207\136\003\312\002\260\171\236\041\046"
	"\365\340\212\244\052\305\076\345\324\334\120\327\336\055\274\123"
	"\061\351\241\223\363\230\362\035\254\144\267\126\162\022\043\215"
	"\144\303\275\111\377\046\254\215\332\075\063\052\162\210\012\366"
	"\100\272\243\067\206\264\003\320\377\364\352\111\365\146\210\117"
	"\032\053\374\050\340\161\331\216\216\166\004\005\324\300\052\003"
	"\264\323\113\315\306\320\264\250\034\265\146\071\057\231\024\060"
	"\055\321\161\310\203\370\104\170\207\255\302\231\210\344\115\130"
	"\012\342\174\133\070\314\177\304\360\345\225\372\105\372\245\065"
	"\241\163\376\225\274\137\225\237\052\341\220\017\067\003\255\222"
	"\101\250\324\167\376\123\265\243\247\115\344\125\022\126\137\175"
	"\115\227\123\333\353\310\037\201\172\226\252\323\050\074\035\371"
	"\071\270\156\176\130\146\376\273\160\004\206\165\140\312\260\235"
	"\225\265\117\376\134\377\002\270\123\107\314\120\274\047\132\111"
	"\262\373\277\075\027\105\264\137\372\111\046\103\376\130\123\202"
	"\310\030\051\334\233\123\311\244\363\150\312\372\177\335\163\154"
	"\143\070\351\000\245\205\025\110\057\021\263\200\336\373\057\100"
	"\120\223\162\147\063\276\347\111\317\301\265\377\314\107\244\331"
	"\317\043\310\164\062\344\270\360\035\255\306\115\046\211\163\226"
	"\250\030\143\375\054\077\321\251\041\021\127\247\267\007\016\220"
	"\267\247\124\114\112\156\273\034\164\070\250\223\014\113\212\014"
	"\304\006\374\160\004\350\324\135\113\126\113\200\367\054\272\321"
	"\302\247\340\144\106\133\237\032\212\066\351\321\211\230\062\042"
	"\120\015\015\376\352\324\107\335\353\061\336\052\372\032\342\135"
	"\005\017\307\344\176\133\337\062\054\201\200\326\311\023\136\125"
	"\072\041\253\305\361\307\015\203\120\266\221\240\345\254\217\141"
	"\031\014\375\243\250\265\345\302\040\334\114\225\146\121\333\373"
	"\224\113\307\005\151\375\271\167\063\006\020\112\310\013\251\367"
	"\077\120\044\263\103\310\075\033\377\237\040\077\146\345\255\066"
	"\001\103\256\373\303\171\256\301\313\250\003\103\065\216\323\133"
	"\045\006\224\273\323\074\161\064\254\204\064\207\164\155\012\003"
	"\075\175\215\274\125\112\363\313\335\242\151\064\077\062\251\273"
	"\357\146\154\302\352\120\150\312\313\370\200\132\341\324\174\225"
	"\310\346\061\354\121\243\046\072\204\130\361\100\132\211\275\121"
	"\174\361\105\164\230\023\173\236\037\334\330\371\235\026\361\306"
	"\172\303\012\317\161\235\165\112\207\176\326\254\114\324\245\311"
	"\352\244\354\307\202\361\334\173\150\260\060\337\030\161\236\107"
	"\304\372\240\152\347\020\273\315\131\121\303\313\212\062\367\113"
	"\036\356\203\337\322\024\217\050\352\150\004\210\225\276\354\177"
	"\254\266\344\047\177\365\012\210\323\304\344\173\353\324\065\042"
	"\307\360\204\330\105\373\271\147\273\247\076\220\102\120\225\166"
	"\073\170\217\152\137\070\367\002\064\136\342\126\303\036\061\300"
	"\347\337\053\316\271\042\071\000\137\376\103\265\314\364\105\030"
	"\252\327\161\255\164\032\270\100\210\317\047\010\344\255\176\040"
	"\074\324\142\314\030\214\050\121\217\171\150\046\324\374\304\055"
	"\157\151\017\330\205\322\130\315\164\135\107\171\374\356\325\055"
	"\222\232\212\273\214\343\117\336\132\150\274\115\203\225\305\046"
	"\014\125\241\011\014\023\076\337\077\323\112\321\112\321\165\212"
	"\134\072\304\260\313\327\217\147\075\266\333\002\333\307\045\013"
	"\161\100\327\307\375\234\161\262\123\164\171\010\063\137\066\302"
	"\273\043\052\130\242\337\354\313\221\113\152\004\111\235\007\370"
	"\362\147\005\172\307\142\126\074\355\350\237\145\323\032\005\223"
	"\052\062\053\151\110\253\054\077\246\251\324\017\070\201\130\037"
	"\146\223\344\107\335\151\260\122\057\312\055\230\050\013\322\151"
	"\175\226\376\016\336\237\107\260\100\302\206\310\153\354\030\171"
	"\121\277\277\015\304\310\145\030\105\140\225\300\331\272\375\136"
	"\326\270\076\022\257\203\117\254\053\233\363\230\063\106\020\010"
	"\105\207\101\167\025\357\363\062\330\340\150\150\230\101\146\131"
	"\252\103\341\136\176\042\052\173\241\132\126\237\122\054\221\271"
	"\142\272\154\366\211\364\117\105\063\331\047\046\274\172\201\360"
	"\102\215\140\325\026\030\127\027\200\014\151\221\035\212\131\230"
	"\371\061\104\230\013\350\306\143\046\310\304\136\242\352\027\325"
	"\007\203\020\020\046\226\103\217\117\322\151\153\203\351\043\325"
	"\223\013\245\064\221\117\357\012\345\077\012\125\244\225\163\240"
	"\200\244\116\314\227\017\317\216\327\257\272\047\023\356\162\311"
	"\107\315\076\073\312\314\214\231\017\120\170\301\116\014\202\226"
	"\316\264\075\013\073\001\075\137\356\237\076\240\336\313\151\063"
	"\005\252\134\324\160\323\221\106\217\176\234\265\266\050\236\204"
	"\313\054\233\000\170\046\234\370\265\351\307\165\262\015\233\032"
	"\205\031\070\141\127\127\173\347\375\366\057\367\353\374\254\164"
	"\151\034\061\111\272\334\173\064\114\325\046\300\015\141\047\245"
	"\176\271\075\227\217\102\011\124\151\176\046\144\330\137\176\146"
	"\275\233\163\142\252\137\374\204\105\305\252\226\063\237\224\056"
	"\064\027\346\264\102\314\226\051\013\241\054\235\234\166\046\330"
	"\122\143\377\060\222\246\311\323\254\205\027\127\274\075\060\014"
	"\203\235\036\315\257\116\011\077\055\026\371\202\231\221\333\046"
	"\044\036\033\102\020\074\215\206\030\102\167\247\044\062\077\143"
	"\012\006\324\071\306\201\356\114\106\106\275\257\272\371\276\350"
	"\160\276\345\017\221\146\363\365\113\230\020\250\102\244\337\053"
	"\133\061\044\167\166\272\010\260\032\312\125\141\137\346\324\213"
	"\363\205\331\305\146\133\244\213\210\301\057\022\030\265\144\024"
	"\340\040\115\216\267\074\161\301\203\037\072\242\335\362\313\174"
	"\367\151\040\323\161\017\066\347\070\043\272\336\240\173\147\341"
	"\305\263\343\314\236\146\306\201\150\045\206\207\145\052\044\151"
	"\305\273\245\053\105\004\200\255\147\353\325\213\243\311\015\011"
	"\352\261\067\121\372\321\077\134\003\144\007\224\162\304\153\320"
	"\034\270\066\362\102\176\364\306\362\147\320\156\350\233\003\136"
	"\360\054\370\150\241\017\374\011\244\270\274\331\052\204\267\060"
	"\141\115\340\235\012\065\012\112\245\275\362\172\263\243\043\070"
	"\225\023\160\034\276\114\116\001\333\024\125\121\262\157\222\153"
	"\205\323\075\166\236\134\210\041\225\146\367\302\312\354\333\307"
	"\376\020\351\013\321\365\047\072\102\005\076\040\101\267\002\075"
	"\105\346\342\112\131\177\060\005\050\123\126\371\155\316\131\376"
	"\105\172\111\140\017\130\315\350\262\073\366\153\002\367\022\363"
	"\220\071\174\272\052\066\370\305\144\351\333\200\010\147\137\373"
	"\370\244\007\107\002\362\232\375\126\027\242\056\052\256\015\001"
	"\077\133\341\042\201\227\053\037\267\001\131\013\320\205\053\067"
	"\267\316\357\306\152\233\261\344\263\314\013\033\005\371\300\151"
	"\165\102\332\163\324\160\353\013\116\335\362\224\350\061\277\027"
	"\007\067\136\152\142\330\134\224\226\221\145\024\150\120\101\224"
	"\254\302\232\075\107\002\303\326\052\363\025\373\031\235\074\157"
	"\033\045\226\367\064\043\175\035\247\365\216\101\007\151\001\320"
	"\107\141\230\301\155\341\045\110\203\072\107\001\152\157\103\101"
	"\146\004\226\211\144\353\255\010\074\371\312\132\316\211\345\176"
	"\326\263\051\273\222\164\305\101\260\306\303\242\360\022\051\357"
	"\060\316\075\052\305\375\055\310\320\226\333\175\334\051\143\026"
	"\375\232\025\310\303\105\114\117\332\243\100\325\244\056\306\301"
	"\015\047\076\044\204\357\150\175\317\310\045\147\231\033\273\372"
	"\074\376\163\252\175\166\256\033\133\176\134\160\306\145\230\344"
	"\233\032\217\115\000\351\134\233\203\201\132\200\121\015\152\341"
	"\050\216\377\211\346\105\074\060\161\127\146\375\131\053\042\330"
	"\107\331\073\043\142\356\123\275\310\322\123\060\027\173\307\323"
	"\224\251\335\106\311\210\261\046\217\245\231\111\145\162\137\076"
	"\367\060\105\133\005\240\220\301\304\331\025\261\051\173\166\006"
	"\275\122\340\341\314\227\145\012\131\017\263\055\070\136\177\053"
	"\315\334\251\337\163\001\043\352\022\202\134\151\107\243\132\051"
	"\227\140\067\050\003\334\341\124\131\350\053\063\377\270\174\262"
	"\376\157\046\141\026\064\340\047\032\375\126\372\033\270\263\150"
	"\373\342\321\234\000\265\131\276\356\107\255\046\327\256\053\107"
	"\146\304\136\135\036\225\103\263\340\344\103\001\317\210\136\373"
	"\126\302\040\315\166\010\362\121\266\155\003\367\032\260\200\226"
	"\215\274\323\332\160\247\121\225\215\251\266\243\057\070\043\177"
	"\251\104\041\066\031\040\222\070\161\050\132\137\332\041\003\356"
	"\017\140\127\066\002\165\265\063\140\275\267\346\111\200\133\316"
	"\012\034\251\155\263\326\015\143\105\135\077\116\215\121\237\351"
	"\305\205\035\036\044\373\102\240\317\046\067\205\141\223\246\166"
	"\111\015\010\351\163\055\247\346\211\073\173\134\337\045\045\013"
	"\014\376\070\255\247\006\002\246\323\216\077\320\300\361\372\032"
	"\261\053\171\203\104\211\211\155\343\114\372\131\124\046\053\073"
	"\163\132\026\052\337\135\210\035\072\370\331\214\144\017\177\140"
	"\375\247\073\064\204\377\364\350\271\002\251\354\176\126\243\206"
	"\344\007\115\153\200\321\152\331\016\131\266\007\353\023\062\202"
	"\337\102\364\070\352\317\223\153\330\113\153\365\130\320\056\073"
	"\215\125\041\165\261\127\156\134\026\106\341\230\121\127\157\146"
	"\032\345\117\232\063\112\107\261\366\277\200\275\313\120\020\214"
	"\031\263\102\161\206\343\111\260\341\151\214\126\266\321\275\377"
	"\257\125\364\307\375\333\202\220\126\315\011\052\150\232\367\350"
	"\071\234\212\361\012\244\311\056\354\312\235\346\261\137\332\262"
	"\027\106\063\210\214\045\237\370\125\173\305\256\013\152\200\165"
	"\332\014\005\142\012\027\166\100\201\266\352\232\222\331\100\107"
	"\307\162\257\217\152\227\253\302\135\375\040\110\236\036\056\212"
	"\304\336\307\141\142\272\222\132\031\066\205\374\174\234\102\204"
	"\313\153\231\076\043\071\205\133\323\252\203\121\050\161\031\355"
	"\207\243\200\055\030\206\117\056\225\175\243\127\062\340\216\233"
	"\324\125\143\060\065\330\253\164\000\122\142\071\060\147\011\050"
	"\023\071\202\001\255\124\071\077\375\314\040\217\300\324\130\024"
	"\323\105\362\313\006\210\133\024\203\351\023\027\145\133\116\030"
	"\316\317\334\201\266\174\252\043\360\147\137\274\202\052\350\221"
	"\240\053\326\070\132\166\327\011\372\365\155\042\160\347\241\323"
	"\211\253\076\315\315\076\307\343\013\354\331\233\037\205\374\277"
	"\324\273\157\306\126\271\137\117\127\314\345\376\173\203\277\023"
	"\046\055\012\152\136\176\153\173\044\277\162\255\224\005\147\055"
	"\342\253\104\244\213\302\026\366\377\105\046\320\267\250\042\174"
	"\142\336\375\337\160\006\365\340\165\072\263\170\316\326\071\353"
	"\223\022\221\304\352\375\275\156\042\171\140\253\113\162\024\035"
	"\074\342\252\367\233\166\144\040\163\113\323\234\372\345\017\253"
	"\303\050\357\164\035\025\013\047\263\037\353\313\241\243\131\224"
	"\146\305\231\304\320\076\352\323\333\271\011\214\011\277\155\260"
	"\157\115\346\345\122\242\113\206\051\362\341\264\127\336\017\035"
	"\032\030\025\357\000\305\225\152\235\223\046\013\173\214\324\225"
	"\213\255\340\223\245\264\064\365\310\004\232\256\277\340\214\224"
	"\271\252\232\116\106\354\345\177\023\362\141\200\144\144\320\135"
	"\125\334\233\052\034\332\126\171\260\170\354\206\220\076\032\210"
	"\071\210\215\201\324\166\076\247\364\101\331\321\176\061\000\264"
	"\170\077\101\331\135\121\347\373\155\060\157\150\141\210\226\330"
	"\160\270\131\035\264\232\342\110\130\265\040\323\170\152\246\061"
	"\217\303\147\211\323\074\326\303\205\132\051\320\255\361\262\126"
	"\014\277\256\225\065\362\163\302\221\177\220\120\250\012\367\054"
	"\304\364\350\037\336\065\357\135\135\102\212\335\222\024\242\111"
	"\133\325\052\373\162\240\261\233\342\045\217\106\226\201\060\233"
	"\342\130\054\056\063\007\343\014\107\244\363\170\000\232\233\365"
	"\365\111\322\114\122\366\055\265\050\330\263\124\252\326\306\031"
	"\371\351\237\175\100\251\155\310\130\116\100\307\330\044\032\011"
	"\066\275\147\307\226\075\276\005\232\211\242\317\162\110\123\100"
	"\172\336\135\370\213\176\242\265\155\237\373\167\016\371\025\260"
	"\306\322\253\142\204\071\276\316\347\377\132\167\314\077\264\115"
	"\355\247\026\117\160\067\270\236\265\102\343\053\140\343\344\320"
	"\037\056\103\025\176\356\354\365\337\215\246\304\337\371\161\271"
	"\021\133\160\222\026\327\325\066\216\367\073\250\326\176\310\161"
	"\214\303\236\240\211\374\005\016\212\320\050\262\247\053\243\130"
	"\033\025\121\240\075\122\276\307\035\173\272\151\246\320\141\214"
	"\047\361\203\210\112\361\012\011\052\371\136\314\316\307\144\147"
	"\346\265\360\245\224\177\212\222\070\337\247\346\053\357\102\333"
	"\033\351\122\031\372\043\065\223\125\365\244\002\111\147\200\335"
	"\115\362\036\235\100\220\210\317\123\075\356\153\255\060\174\017"
	"\235\364\276\114\026\112\056\041\332\012\004\360\155\241\322\300"
	"\127\244\250\352\207\136\135\042\211\043\166\177\244\155\013\071"
	"\335\271\373\217\215\105\357\330\277\301\326\346\062\377\100\054"
	"\361\341\153\236\234\047\030\270\212\052\151\263\035\335\077\045"
	"\231\356\236\155\355\040\317\141\066\057\366\117\251\236\306\154"
	"\323\144\012\144\034\274\141\142\226\104\070\156\341\165\041\232"
	"\253\377\106\256\004\327\114\065\263\057\241\223\366\062\071\032"
	"\321\370\111\245\163\152\003\340\141\136\270\054\164\205\217\154"
	"\060\030\265\053\014\002\066\371\104\375\346\313\264\276\170\157"
	"\260\171\237\176\342\377\177\031\367\157\142\353\223\116\001\024"
	"\164\030\262\043\052\175\114\304\141\335\355\076\156\024\154\123"
	"\055\223\246\324\143\045\004\030\202\165\165\317\047\204\163\325"
	"\122\355\315\370\353\321\055\327\352\073\243\171\116\010\235\312"
	"\166\134\206\332\330\246\127\253\342\335\166\133\026\023\206\000"
	"\230\072\141\173\140\334\344\044\026\263\277\007\343\107\311\217"
	"\130\327\201\016\145\223\350\167\014\245\221\374\026\277\361\316"
	"\263\154\330\031\245\310\332\376\347\000\261\224\226\303\113\057"
	"\051\352\135\033\023\274\267\264\171\267\052\313\337\001\270\230"
	"\320\200\051\114\244\311\010\274\276\242\205\146\056\330\255\200"
	"\016\325\234\033\241\011\205\111\240\121\255\351\335\165\273\042"
	"\050\061\070\232\035\361\357\075\312\016\035\352\315\313\152\334"
	"\240\007\370\102\020\175\214\260\317\071\231\255\257\125\317\327"
	"\207\010\162\244\371\142\341\304\160\377\256\076\312\031\032\153"
	"\040\022\255\061\220\071\341\140\163\173\015\042\320\335\372\127"
	"\345\154\374\336\316\336\243\077\335\121\175\247\152\227\022\213"
	"\252\277\274\073\370\236\233\154\032\250\216\353\206\211\103\153"
	"\366\077\112\304\035\355\003\372\077\201\242\251\030\265\065\303"
	"\164\361\376\155\217\231\331\252\102\150\225\310\362\330\063\350"
	"\027\176\255\065\153\261\060\252\062\323\124\113\210\211\016\375"
	"\173\015\152\013\246\104\265\351\255\112\261\237\043\345\210\073"
	"\143\065\160\317\347\241\171\031\164\315\145\374\127\163\371\322"
	"\201\144\336\047\251\223\021\127\336\302\367\001\250\177\074\014"
	"\265\255\333\234\116\124\266\303\042\033\277\172\217\271\115\020"
	"\036\053\070\310\277\111\037\235\014\027\236\265\227\333\301\114"
	"\210\234\351\327\361\240\232\023\274\132\216\114\024\333\134\063"
	"\007\225\373\306\337\033\144\354\063\003\241\312\336\142\026\147"
	"\376\000\076\357\241\331\003\135\063\222\251\110\155\006\173\165"
	"\233\167\074\172\223\240\147\306\243\010\220\202\152\247\351\151"
	"\247\050\131\110\001\134\246\065\356\117\175\134\125\371\322\361"
	"\160\016\154\003\256\323\311\122\333\132\324\106\001\275\257\251"
	"\345\010\361\347\145\227\034\123\347\232\260\075\223\203\056\004"
	"\221\232\007\100\156\321\222\111\053\146\217\055\043\076\326\011"
	"\107\310\360\254\137\015\377\107\247\260\204\072\064\262\077\305"
	"\115\107\005\273\031\227\005\104\375\224\162\041\323\110\052\032"
	"\020\033\306\160\050\306\267\317\167\073\012\253\356\112\161\074"
	"\221\166\367\252\016\374\357\013\221\141\055\145\251\130\177\272"
	"\163\106\052\234\015\342\154\204\036\166\060\014\301\241\110\122"
	"\027\100\374\046\075\353\061\316\115\137\063\366\267\263\261\052"
	"\371\333\306\007\275\062\213\334\251\273\350\152\134\061\275\164"
	"\161\271\232\257\245\314\175\362\054\261\351\343\145\232\016\137"
	"\166\324\146\064\007\361\020\261\255\370\034\012\052\331\176\234"
	"\222\031\113\067\346\310"
#define      shll_z	10
#define      shll	((&data[6473]))
	"\331\222\141\254\056\355\031\212\231\127\023"
#define      chk2_z	19
#define      chk2	((&data[6488]))
	"\004\076\043\330\216\112\014\342\270\142\125\211\157\042\373\036"
	"\274\245\157\266\361\330\327\244\127\340"
#define      tst2_z	19
#define      tst2	((&data[6512]))
	"\103\140\027\335\206\131\130\115\104\155\116\277\137\035\005\061"
	"\214\113\366\343\033\256\115"
#define      pswd_z	256
#define      pswd	((&data[6567]))
	"\047\032\346\162\121\315\073\174\337\265\217\325\224\075\331\323"
	"\141\262\170\271\223\016\041\045\122\201\323\240\014\132\154\063"
	"\164\123\120\057\216\056\140\307\055\365\253\025\032\212\145\116"
	"\314\354\047\157\004\347\174\217\231\044\062\220\034\025\113\234"
	"\062\234\313\301\312\053\210\370\041\063\015\073\275\163\212\212"
	"\137\261\372\144\231\166\363\062\233\046\303\270\073\016\124\156"
	"\253\040\057\166\114\270\156\155\354\173\250\251\357\063\064\117"
	"\344\056\263\175\245\247\257\101\315\162\372\011\201\116\167\054"
	"\156\247\243\272\137\021\050\113\215\320\365\174\004\051\313\350"
	"\130\176\145\376\046\025\077\363\210\071\374\011\210\164\066\367"
	"\033\331\262\172\353\332\306\170\253\273\365\257\345\301\230\075"
	"\100\376\073\146\023\173\132\233\265\127\245\075\313\334\065\346"
	"\266\347\141\241\302\047\032\155\343\020\035\310\321\265\006\021"
	"\264\101\170\307\275\322\143\162\051\011\260\364\345\345\333\234"
	"\315\074\076\217\144\131\375\110\151\033\020\073\321\026\115\205"
	"\130\305\114\026\227\260\210\300\272\070\265\240\035\221\074\352"
	"\315\172\172\062\323\167\172\075\223\213\170\144\242\305\351\373"
	"\213\066\021\042\346\232\343\240\322\231\100\360\052\175\333\370"
	"\370\126\246\306\040\341\103\000\226\322\325\053\017\257\377\160"
	"\142\167\052\365\205\113\033\330\314\356\170\331\111\344\015\276"
	"\070\263\205\130\225\310\130\054\232\056\127\252\336\127\033\100"
	"\316\105\066\124\220"
#define      inlo_z	3
#define      inlo	((&data[6874]))
	"\162\145\151"
#define      xecc_z	15
#define      xecc	((&data[6879]))
	"\211\211\151\337\061\364\255\252\102\133\147\220\251\276\126\173"
	"\015"
#define      msg1_z	65
#define      msg1	((&data[6898]))
	"\370\315\031\216\307\057\320\134\310\360\323\250\375\040\072\361"
	"\076\326\223\005\165\265\156\122\000\174\173\051\251\337\036\235"
	"\255\135\244\036\034\036\234\367\246\355\372\270\351\171\242\155"
	"\365\150\275\146\254\240\353\100\360\374\172\372\252\352\077\063"
	"\107\115\266\052\052\225\162\272\060\240\022\332\176\151\366\277"
	"\067"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
